<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>éå¹´ KTV ç¸½éƒ¨</title>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-database-compat.js"></script>
    <style>
        body { background: #1a1a1a; color: white; font-family: sans-serif; display: flex; margin: 0; height: 100vh; }
        #main { flex: 3; padding: 20px; text-align: center; }
        #sidebar { flex: 1; background: #252525; padding: 20px; border-left: 1px solid #444; }
        #player { width: 100%; aspect-ratio: 16/9; background: #000; }
        .song-item { padding: 10px; border-bottom: 1px solid #333; list-style: none; color: #00ff00; }
    </style>
</head>
<body>

<div id="main">
    <h1>ğŸ¤ æˆ‘å€‘çš„å®¶åº­ KTV</h1>
    <div id="player"></div>
    <br>
    <button onclick="playNext()" style="padding:10px 20px; font-size:18px; cursor:pointer;">ä¸‹ä¸€é¦– (åˆ‡æ­Œ)</button>
</div>

<div id="sidebar">
    <h3>å¾…æ’­æ¸…å–®</h3>
    <ul id="songList"></ul>
</div>

<script>
    // æ ¹æ“šä½ çš„æˆªåœ–ç²¾ç¢ºå¡«å¯«çš„è¨­å®š
    const firebaseConfig = {
  apiKey: "AIzaSyB7FxIh0oUu21zTLxnhOttyN_kL0LiYAPw",
  authDomain: "my-karaoke-5b9e3.firebaseapp.com",
  databaseURL: "https://my-karaoke-5b9e3-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "my-karaoke-5b9e3",
  storageBucket: "my-karaoke-5b9e3.firebasestorage.app",
  messagingSenderId: "229614265706",
  appId: "1:229614265706:web:06c5e2c498baa7f1b5f113",
  measurementId: "G-1YVK3HE4VK"
};

    // åˆå§‹åŒ– Firebase
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // YouTube æ’­æ”¾å™¨è¨­å®š
    var tag = document.createElement('script');
    tag.src = "https://www.youtube.com/iframe_api";
    document.head.appendChild(tag);

    var player;
    var currentSongs = [];

    function onYouTubeIframeAPIReady() {
        player = new YT.Player('player', {
            events: { 'onStateChange': (e) => { if(e.data == 0) playNext(); } }
        });
    }

    // æ ¸å¿ƒï¼šç›£è½è³‡æ–™åº«
    db.ref('playlist').on('value', (snapshot) => {
        const data = snapshot.val();
        const listUI = document.getElementById('songList');
        listUI.innerHTML = '';
        currentSongs = [];

        if (data) {
            Object.keys(data).forEach(key => {
                currentSongs.push({ key: key, ...data[key] });
                const li = document.createElement('li');
                li.className = 'song-item';
                li.innerText = data[key].title;
                listUI.appendChild(li);
            });

            // å¦‚æœç›®å‰æ²’åœ¨æ’­æ”¾ä¸”æ¸…å–®æœ‰æ­Œï¼Œå°±æ’­ç¬¬ä¸€é¦–
            if (player && player.getPlayerState && player.getPlayerState() !== 1) {
                playNext();
            }
        }
    });

    function playNext() {
        if (currentSongs.length > 0) {
            const next = currentSongs[0];
            player.loadVideoById(next.ytId);
            // æ’­æ”¾å¾Œå¾è³‡æ–™åº«åˆªé™¤ï¼Œé¿å…é‡è¤‡æ’­æ”¾
            db.ref('playlist/' + next.key).remove();
        }
    }
</script>
</body>
</html>