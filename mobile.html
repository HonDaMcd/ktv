<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KTV é»æ­Œé™æ§å™¨</title>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-database-compat.js"></script>
    <style>
        body { font-family: sans-serif; background: #121212; color: white; padding: 20px; text-align: center; }
        .card { background: #1e1e1e; padding: 20px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.5); }
        input { width: 90%; padding: 12px; margin: 10px 0; border: none; border-radius: 8px; background: #333; color: white; font-size: 16px; }
        .search-btn { background: #ff0000; color: white; font-weight: bold; }
        .send-btn { background: #00c853; color: white; font-weight: bold; margin-top: 20px; }
        .priority-btn { background: #ffab00; color: white; font-weight: bold; }
        button { width: 95%; padding: 15px; border: none; border-radius: 8px; font-size: 16px; cursor: pointer; margin: 5px 0; }
        .steps { text-align: left; font-size: 13px; color: #aaa; margin-top: 20px; line-height: 1.6; }
    </style>
</head>
<body>

    <div class="card">
        <h2>ğŸ¤ é»æ­Œé™æ§å™¨</h2>
        
        <input type="text" id="keyword" placeholder="ç¬¬ä¸€æ­¥ï¼šè¼¸å…¥æ­Œå (å¦‚: å‘Šç™½æ°£çƒ)">
        <button class="search-btn" onclick="openSearch()">ğŸ” å…ˆåœ¨ YouTube æœå°‹å½±ç‰‡</button>
        
        <hr style="margin: 20px 0; border: 0.5px solid #444;">

        <input type="text" id="songTitle" placeholder="ç¬¬äºŒæ­¥ï¼šç¢ºèªæ­Œå">
        <input type="text" id="ytId" placeholder="ç¬¬ä¸‰æ­¥ï¼šè²¼ä¸Šå½±ç‰‡ ID æˆ–ç¶²å€">
        
        <button class="send-btn" onclick="sendSong(false)">âœ… ç¢ºèªé»æ­Œ</button>
        <button class="priority-btn" onclick="sendSong(true)">ğŸ”¥ æˆ‘è¦æ’æ’­</button>

        <div class="steps">
            <strong>ä½¿ç”¨èªªæ˜ï¼š</strong><br>
            1. è¼¸å…¥æ­Œåå¾ŒæŒ‰ç´…è‰²æœå°‹éˆ•ï¼Œæœƒè·³è½‰åˆ° YouTubeã€‚<br>
            2. æ‰¾åˆ°æƒ³å”±çš„å½±ç‰‡ï¼Œ**è¤‡è£½ç¶²å€**ã€‚<br>
            3. å›åˆ°é€™è£¡è²¼ä¸Šç¶²å€ï¼ŒæŒ‰ä¸‹ç¶ è‰²é»æ­Œéˆ•å³å¯ï¼
        </div>
    </div>

    <script>
        // *** è«‹ç¢ºä¿é€™è£¡çš„ firebaseConfig è·Ÿä½ çš„ index.html ä¸€æ¨¡ä¸€æ¨£ ***
        const firebaseConfig = {
  apiKey: "AIzaSyB7FxIh0oUu21zTLxnhOttyN_kL0LiYAPw",
  authDomain: "my-karaoke-5b9e3.firebaseapp.com",
  databaseURL: "https://my-karaoke-5b9e3-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "my-karaoke-5b9e3",
  storageBucket: "my-karaoke-5b9e3.firebasestorage.app",
  messagingSenderId: "229614265706",
  appId: "1:229614265706:web:06c5e2c498baa7f1b5f113",
  measurementId: "G-1YVK3HE4VK"
};

        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        // è‡ªå‹•è·³è½‰ YouTube æœå°‹
        function openSearch() {
            const kw = document.getElementById('keyword').value;
            if(!kw) return alert("è«‹å…ˆè¼¸å…¥æ­Œåå–”ï¼");
            document.getElementById('songTitle').value = kw; // é †ä¾¿å¹«ä»–å¡«å¥½æ­Œå
            window.open(`https://www.youtube.com/results?search_query=${encodeURIComponent(kw + ' KTV')}`, '_blank');
        }

        function extractId(input) {
    const regExp = /^.*((youtu.be\/)|(v\/)|(\/u\/\w\/)|(embed\/)|(watch\?))\??v?=?([^#&?]*).*/;
    const match = input.match(regExp);
    return (match && match[7].length == 11) ? match[7] : input.trim();
}

        function sendSong(isPriority) {
            const title = document.getElementById('songTitle').value;
            let id = document.getElementById('ytId').value;
            id = extractId(id); // æå– ID

            if (!title || !id) return alert("è³‡è¨Šä¸å®Œæ•´å–”ï¼");

            // å¦‚æœæ˜¯æ’æ’­ï¼Œæˆ‘å€‘è¦è®“å®ƒåœ¨è³‡æ–™åº«æ’åºé å‰
            const playlistRef = db.ref('playlist');
            const newSongRef = playlistRef.push();
            
            newSongRef.set({
                title: title,
                ytId: id,
                timestamp: isPriority ? Date.now() * -1 : Date.now() // ç°¡å–®çš„æ’åºé‚è¼¯
            }).then(() => {
                alert("é»æ­ŒæˆåŠŸï¼è«‹çœ‹é›»è¦–è¢å¹•");
                document.getElementById('keyword').value = '';
                document.getElementById('songTitle').value = '';
                document.getElementById('ytId').value = '';
            });
        }
    </script>
</body>
</html>